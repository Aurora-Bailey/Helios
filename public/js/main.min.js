"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}String.prototype.toUpperCaseFirst=function(){return this.charAt(0).toUpperCase()+this.slice(1)};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),engine=function(){function engine(){_classCallCheck(this,engine)}return _createClass(engine,null,[{key:"mapGenBlock",value:function(elements){for(var block_height=100,block_width=100,grid=[],a=0;block_height>a;a++){grid[a]=[];for(var b=0;block_width>b;b++)grid[a][b]=0}for(var _loop=function(i){for(place_count=0;place_count<elements[i].rarity;)random_a=Math.floor(Math.random()*block_height),random_b=Math.floor(Math.random()*block_width),0==grid[random_a][random_b]&&(grid[random_a][random_b]=i,place_count++),place_count==elements[i].rarity&&!function(){var clusterSize=function clusterSize(a,b){var count=0;return count++,grid[a][b]=-1,"undefined"!=typeof grid[a][b-1]&&grid[a][b-1]==i&&(count+=clusterSize(a,b-1)),"undefined"!=typeof grid[a][b+1]&&grid[a][b+1]==i&&(count+=clusterSize(a,b+1)),"undefined"!=typeof grid[a-1]&&grid[a-1][b]==i&&(count+=clusterSize(a-1,b)),"undefined"!=typeof grid[a+1]&&grid[a+1][b]==i&&(count+=clusterSize(a+1,b)),grid[a][b]=i,count};for(console.log("evaluate",i),a=0;block_height>a;a++)for(b=0;block_width>b;b++)grid[a][b]==i&&(cluster=clusterSize(a,b),cluster<elements[i].cluster&&(grid[a][b]=0,place_count--,console.log("remove ",i)),cluster>10&&console.log(cluster," ",i))}()},i=1;i<elements.length;i++){var place_count,random_a,random_b,cluster;_loop(i)}return grid}},{key:"quickDrawMapBlock",value:function(block,map){var $body=$("body"),$block=$('<div class="helios-block"></div>');block.forEach(function(a){var $row=$('<div class="helios-row"></div>');a.forEach(function(b){var $cell=$('<div class="helios-cell" style="background-color: '+map[b].color+'"></div>');$row.append($cell)}),$block.append($row)}),$body.append($block)}}]),engine}(),map=[{name:"Dirt",reward:0,cluster:1,rarity:0,variance:1.2,health:100,hardness:0,color:"#000000"},{name:"Vorite",reward:354,cluster:2,rarity:5e3,variance:1.2,health:100,hardness:10,color:"red"},{name:"Argios",reward:242,cluster:2,rarity:1e3,variance:1.2,health:100,hardness:10,color:"orange"},{name:"Demite",reward:142,cluster:2,rarity:500,variance:1.2,health:100,hardness:10,color:"yellow"},{name:"Blue Stuff",reward:142,cluster:2,rarity:250,variance:1.2,health:100,hardness:10,color:"lime"},{name:"super rare",reward:142,cluster:2,rarity:125,variance:1.2,health:100,hardness:10,color:"cyan"}],_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),Lib=function(){function Lib(){_classCallCheck(this,Lib)}return _createClass(Lib,null,[{key:"objectKeyArray",value:function(obj){var arr=[];for(var key in obj)arr.push(key);return arr}},{key:"weightedRandom",value:function(obj){var total=0;for(var key in obj)total+=obj[key];var r=Math.random()*total;for(var key in obj){if(r<obj[key])return key;r-=obj[key]}}},{key:"randomProperty",value:function(obj){var total=0;for(var key in obj)total+=1;var r=Math.random()*total;for(var key in obj){if(1>r)return obj[key];r-=1}}},{key:"inCommonProperty",value:function(obj,obj2){var r={};for(var key in obj)"undefined"!=typeof obj2[key]&&(r[key]=obj[key]);return r}},{key:"notProperty",value:function(obj,exclude_arr){var r={};for(var key in obj)-1==exclude_arr.indexOf(key)&&(r[key]=obj[key]);return r}},{key:"deepCopy",value:function(obj){return JSON.parse(JSON.stringify(obj))}},{key:"isObjEmpty",value:function(obj){if(null==obj)return!0;if(obj.length>0)return!1;if(0===obj.length)return!0;for(var key in obj)if(obj.hasOwnProperty(key))return!1;return!0}},{key:"socialMediaPost",value:function(site,url){"facebook"==site?window.open("http://www.facebook.com/share.php?u="+url,"Facebook","width=550,height=400"):"twitter"==site&&window.open("http://twitter.com/intent/tweet?status="+$(document).find("title").text()+"+"+url,"Twitter","width=550,height=400")}}]),Lib}(),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),WS=function(){function WS(){_classCallCheck(this,WS)}return _createClass(WS,null,[{key:"init",value:function(){this.server=null,this.connected=!1,this.failCount=0,this.startWebSocket()}},{key:"startWebSocket",value:function(){var _this=this;return this.connected?!1:(__DEV?this.server=new WebSocket("ws://localhost:7777/"):this.server=new WebSocket("ws://ws."+__DOMAIN+"/"),this.server.onopen=function(){_this.failCount=0,_this.connected=!0},this.server.onclose=function(){_this.connected=!1,_this.failCount++;var waitTime=1e3*Math.random()*_this.failCount;setTimeout(function(){return _this.startWebSocket()},waitTime)},void(this.server.onmessage=function(e){Route.handle(JSON.parse(e.data))}))}},{key:"sendObj",value:function(object){return 0==this.connected?(alert("WebSocket is not connected."),!1):void this.server.send(JSON.stringify(object))}}]),WS}();WS.init();